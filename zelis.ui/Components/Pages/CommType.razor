@page "/commtype"
@rendermode InteractiveServer
@using System.Net.Http.Json
@inject HttpClient Http

<h3>Create Communication Type</h3>

<div style="margin-bottom:8px">
  <label>Type Code</label><br />
  <input @bind="typeCode" />
</div>

<div style="margin-bottom:8px">
  <label>Display Name</label><br />
  <input @bind="displayName" />
</div>

<button @onclick="CreateAsync">Create</button>

@if (!string.IsNullOrWhiteSpace(status))
{
  <p style="margin-top:8px">@status</p>
}

@code {
  private string typeCode = "";
  private string displayName = "";
  private string status = "";

  private async Task CreateAsync()
  {
    // minimal payload your controller expects
    var payload = new
    {
      TypeCode = typeCode?.Trim() ?? "",
      DisplayName = displayName?.Trim() ?? "",
      AllowedStatuses = Array.Empty<object>() // empty list is fine
    };

    try
    {
      status = "Posting…";
      var resp = await Http.PostAsJsonAsync("api/CommunicationType", payload);
      var body = await resp.Content.ReadAsStringAsync();
      status = $"HTTP {(int)resp.StatusCode} {resp.StatusCode}" + (string.IsNullOrWhiteSpace(body) ? "" : $" — {body}");

      if (resp.IsSuccessStatusCode)
      {
        typeCode = "";
        displayName = "";
      }
    }
    catch (Exception ex)
    {
      status = "EXCEPTION: " + ex.Message;
    }
  }
}
